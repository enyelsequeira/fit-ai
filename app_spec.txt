<project_specification>
  <project_name>Fit AI - Comprehensive Fitness Tracking Application</project_name>

  <overview>
    Build a full-featured fitness tracking application with workout logging, exercise library,
    goal setting, progress tracking, and AI-powered recommendations. The application provides
    a modern, responsive interface for tracking workouts, monitoring progress, and achieving
    fitness goals. Uses a type-safe API layer with oRPC and a React frontend with TanStack.
  </overview>

  <technology_stack>
    <frontend>
      <framework>React 19 with TanStack Start (Vite-based)</framework>
      <routing>TanStack Router (file-based routing)</routing>
      <state_management>TanStack Query with oRPC integration</state_management>
      <styling>TailwindCSS 4 with class-variance-authority</styling>
      <forms>TanStack Form</forms>
      <ui_components>shadcn/ui components</ui_components>
      <port>Frontend runs on port 3001</port>
    </frontend>
    <backend>
      <runtime>Cloudflare Workers with Hono</runtime>
      <api>oRPC (type-safe RPC layer)</api>
      <database>Drizzle ORM with SQLite/D1</database>
      <authentication>better-auth with cookie sessions</authentication>
      <port>API runs on port 3000</port>
    </backend>
    <monorepo>
      <manager>pnpm 10 workspaces</manager>
      <orchestration>Turborepo</orchestration>
      <testing>Vitest</testing>
      <linting>Oxlint + Oxfmt</linting>
    </monorepo>
  </technology_stack>

  <project_structure>
    <apps>
      <web>
        React frontend with TanStack Start
        - src/routes/ - File-based routing
        - src/components/ - UI components (shadcn/ui)
        - src/hooks/ - Custom React hooks
        - src/lib/ - Utilities (cn, orpc client)
      </web>
      <server>
        Hono API server for Cloudflare Workers
        - src/index.ts - Server entry point
        - Mounts oRPC router and auth
      </server>
    </apps>
    <packages>
      <api>
        oRPC routers and business logic
        - src/routers/ - Domain routers (exercise, workout, goals, etc.)
        - src/index.ts - Procedure definitions (publicProcedure, protectedProcedure)
        - src/errors.ts - Error handling utilities
        - Each router follows: contracts.ts → schemas.ts → handlers.ts → routes.ts
      </api>
      <auth>
        better-auth configuration
        - Authentication setup and session management
      </auth>
      <db>
        Drizzle ORM schema and migrations
        - src/schema/ - Table definitions
        - src/migrations/ - Database migrations
        - src/seed/ - Seed data scripts
      </db>
      <env>
        Environment validation with @t3-oss/env
      </env>
    </packages>
  </project_structure>

  <core_features>
    <exercise_library>
      - 873+ exercises from Free Exercise DB with images
      - Categorized by muscle group (chest, back, shoulders, arms, legs, core)
      - Detailed instructions, difficulty levels, equipment requirements
      - Create custom exercises (authenticated users)
      - Paginated browsing with search and filters
      - Filter by category, exercise type, equipment, muscle group
    </exercise_library>

    <workout_tracking>
      - Log workouts with multiple exercises
      - Track sets with reps, weight, duration
      - Set types: normal, warmup, dropset, failure, rest-pause
      - RPE (Rate of Perceived Exertion) tracking (1-10 scale)
      - RIR (Reps in Reserve) tracking
      - Superset support (group exercises)
      - Rest timer between sets
      - Workout notes and ratings
      - Active workout session management
    </workout_tracking>

    <workout_templates>
      - Create reusable workout templates
      - Template folders for organization
      - Start workout from template
      - Edit and update templates
      - Share templates (future feature)
    </workout_templates>

    <goals_system>
      - 5 goal types: weight, strength, body_measurement, workout_frequency, custom
      - Target value and current value tracking
      - Progress history with timestamps
      - Goal status: active, paused, completed, abandoned
      - Visual progress indicators (percentage)
      - Goal deadlines and reminders
    </goals_system>

    <progress_tracking>
      - Body measurements tracking (weight, body fat, muscle measurements)
      - Progress photos with before/after comparison
      - Personal records (PRs) detection and history
      - Training volume analytics
      - Strength progression charts
      - Weekly/monthly summaries
    </progress_tracking>

    <recovery_system>
      - Daily recovery check-ins
      - Track: sleep quality, stress level, soreness, energy
      - Recovery score calculation (0-100)
      - Trend analysis over time
      - Muscle recovery mapping
      - Recommendations based on recovery
    </recovery_system>

    <ai_features>
      - AI-powered workout generator
      - Training recommendations based on history
      - Workout analysis and suggestions
      - Exercise substitution recommendations
    </ai_features>

    <user_settings>
      - Profile management
      - Unit preferences (metric/imperial)
      - Theme preferences
      - Notification settings
      - Data export
    </user_settings>
  </core_features>

  <database_schema>
    <tables>
      <user>
        - id, email, name, emailVerified
        - image, createdAt, updatedAt
      </user>

      <session>
        - id, userId, token, expiresAt
        - ipAddress, userAgent
        - createdAt, updatedAt
      </session>

      <exercise>
        - id, name, description
        - category (chest, back, shoulders, arms, legs, core)
        - muscleGroups (JSON array)
        - equipment, exerciseType (strength, cardio, flexibility, etc.)
        - difficulty, instructions
        - images (JSON array of URLs)
        - isDefault (boolean), createdByUserId
        - createdAt, updatedAt
      </exercise>

      <workout>
        - id, userId, name, notes
        - startedAt, completedAt
        - rating, templateId
        - createdAt, updatedAt
      </workout>

      <workout_exercise>
        - id, workoutId, exerciseId
        - order, notes, supersetGroup
        - createdAt
      </workout_exercise>

      <workout_set>
        - id, workoutExerciseId
        - setNumber, setType
        - weight, reps, duration
        - rpe, rir, isCompleted
        - createdAt
      </workout_set>

      <workout_template>
        - id, userId, name, description
        - folderId, isPublic
        - createdAt, updatedAt
      </workout_template>

      <template_folder>
        - id, userId, name
        - parentFolderId
        - createdAt, updatedAt
      </template_folder>

      <goal>
        - id, userId, name, description
        - goalType, targetValue, currentValue
        - unit, startDate, targetDate
        - status (active, paused, completed, abandoned)
        - createdAt, updatedAt
      </goal>

      <goal_progress>
        - id, goalId, value
        - notes, recordedAt
        - createdAt
      </goal_progress>

      <body_measurement>
        - id, userId, measurementType
        - value, unit
        - measuredAt, notes
        - createdAt
      </body_measurement>

      <progress_photo>
        - id, userId, imageUrl
        - category (front, side, back)
        - notes, takenAt
        - createdAt
      </progress_photo>

      <personal_record>
        - id, userId, exerciseId
        - recordType (weight, reps, volume)
        - value, previousValue
        - achievedAt, workoutId
        - createdAt
      </personal_record>

      <recovery_checkin>
        - id, userId
        - sleepQuality (1-10)
        - stressLevel (1-10)
        - sorenessLevel (1-10)
        - energyLevel (1-10)
        - recoveryScore (calculated 0-100)
        - notes, checkinDate
        - createdAt
      </recovery_checkin>

      <user_settings>
        - id, userId
        - weightUnit (kg, lbs)
        - distanceUnit (km, miles)
        - theme (light, dark, system)
        - notifications (JSON)
        - createdAt, updatedAt
      </user_settings>
    </tables>
  </database_schema>

  <api_endpoints>
    <auth>
      - POST /api/auth/sign-up/email
      - POST /api/auth/sign-in/email
      - POST /api/auth/sign-out
      - GET /api/auth/session
      - GET /api/auth/profile
    </auth>

    <exercises>
      - GET /rpc/exercise/list - List exercises with filters
      - GET /rpc/exercise/getById - Get single exercise
      - POST /rpc/exercise/create - Create custom exercise
      - PATCH /rpc/exercise/update - Update custom exercise
      - DELETE /rpc/exercise/delete - Delete custom exercise
      - GET /rpc/exercise/getEquipmentList - Get equipment types
      - GET /rpc/exercise/getMuscleGroups - Get muscle groups
      - GET /rpc/exercise/checkNameAvailability - Check name
    </exercises>

    <workouts>
      - GET /rpc/workout/list - List user workouts
      - GET /rpc/workout/getById - Get workout details
      - POST /rpc/workout/create - Start new workout
      - PATCH /rpc/workout/update - Update workout
      - DELETE /rpc/workout/delete - Delete workout
      - POST /rpc/workout/complete - Complete workout
      - POST /rpc/workout/addExercise - Add exercise to workout
      - POST /rpc/workout/addSet - Add set to exercise
    </workouts>

    <templates>
      - GET /rpc/template/list - List templates
      - GET /rpc/template/getById - Get template
      - POST /rpc/template/create - Create template
      - PATCH /rpc/template/update - Update template
      - DELETE /rpc/template/delete - Delete template
      - POST /rpc/template/startWorkout - Start from template
    </templates>

    <goals>
      - GET /rpc/goals/list - List user goals
      - GET /rpc/goals/getById - Get goal details
      - POST /rpc/goals/create - Create goal
      - PATCH /rpc/goals/update - Update goal
      - DELETE /rpc/goals/delete - Delete goal
      - POST /rpc/goals/updateProgress - Log progress
      - GET /rpc/goals/getProgress - Get progress history
    </goals>

    <body_measurement>
      - GET /rpc/bodyMeasurement/list - List measurements
      - POST /rpc/bodyMeasurement/create - Log measurement
      - DELETE /rpc/bodyMeasurement/delete - Delete measurement
    </body_measurement>

    <progress_photo>
      - GET /rpc/progressPhoto/list - List photos
      - POST /rpc/progressPhoto/create - Upload photo
      - DELETE /rpc/progressPhoto/delete - Delete photo
    </progress_photo>

    <personal_record>
      - GET /rpc/personalRecord/list - List PRs
      - GET /rpc/personalRecord/getByExercise - PRs for exercise
    </personal_record>

    <recovery>
      - GET /rpc/recovery/list - List check-ins
      - POST /rpc/recovery/create - Log check-in
      - GET /rpc/recovery/getLatest - Get latest check-in
      - GET /rpc/recovery/getTrends - Get recovery trends
    </recovery>

    <analytics>
      - GET /rpc/analytics/summary - Training summary
      - GET /rpc/analytics/volume - Volume over time
      - GET /rpc/analytics/frequency - Workout frequency
    </analytics>

    <ai>
      - POST /rpc/ai/generateWorkout - Generate workout
      - POST /rpc/ai/analyzeWorkout - Analyze workout
      - POST /rpc/ai/getRecommendations - Get recommendations
    </ai>

    <settings>
      - GET /rpc/settings/get - Get user settings
      - PATCH /rpc/settings/update - Update settings
    </settings>
  </api_endpoints>

  <api_patterns>
    <router_structure>
      Each API router in packages/api/src/routers/<name>/ follows:

      contracts.ts - Route contracts with oRPC
        - Define procedure + route config + input/output schemas
        - Export handler types inferred from contracts

      schemas.ts - Zod validation schemas
        - Input schemas for each endpoint
        - Output schemas for responses
        - Shared types

      handlers.ts - Business logic
        - Database operations
        - Error handling
        - Business rules

      routes.ts - Connect contracts to handlers
        - Wire up handlers to contracts

      index.ts - Export router
        - Combine all routes
        - Re-export schemas and handlers
    </router_structure>

    <procedure_types>
      publicProcedure - No authentication required
        - context.session may be null

      protectedProcedure - Authentication required
        - context.session guaranteed non-null
        - Throws UNAUTHORIZED if not authenticated
    </procedure_types>

    <error_handling>
      import { ORPCError } from "@orpc/server";

      throw new ORPCError("UNAUTHORIZED");
      throw new ORPCError("NOT_FOUND", { message: "Exercise not found" });
      throw new ORPCError("BAD_REQUEST", { message: "Invalid input" });
      throw new ORPCError("FORBIDDEN", { message: "Not allowed" });
    </error_handling>
  </api_patterns>

  <frontend_patterns>
    <data_fetching>
      // Query data
      const { data, isLoading } = useQuery(orpc.exercise.list.queryOptions({
        category: "chest",
        page: 1,
        limit: 20
      }));

      // Mutations
      const mutation = useMutation(orpc.workout.create.mutationOptions({
        onSuccess: () => queryClient.invalidateQueries({ queryKey: ["workouts"] })
      }));
    </data_fetching>

    <routing>
      // File-based routes in src/routes/
      // src/routes/workouts.tsx → /workouts
      // src/routes/exercises/$id.tsx → /exercises/:id

      export const Route = createFileRoute("/workouts")({
        component: WorkoutsPage,
      });
    </routing>

    <styling>
      // Use cn() for conditional classes
      import { cn } from "@/lib/utils";

      <div className={cn("base-class", isActive && "active-class")} />

      // Use CVA for variants
      const buttonVariants = cva("base", {
        variants: { size: { sm: "...", lg: "..." } }
      });
    </styling>
  </frontend_patterns>

  <commands>
    <development>
      pnpm dev - Start all apps (frontend + server)
      pnpm dev:web - Start frontend only (port 3001)
      pnpm dev:server - Start API server only (port 3000)
    </development>
    <testing>
      pnpm test - Run all tests
      pnpm -F @fit-ai/api test - Run API tests only
      pnpm -F @fit-ai/api test:watch - Watch mode
    </testing>
    <quality>
      pnpm check-types - TypeScript checking
      pnpm check - Oxlint + Oxfmt
    </quality>
    <database>
      pnpm db:push - Push schema to local D1
      pnpm db:generate - Generate migrations
      pnpm -F @fit-ai/db db:seed:free-exercise-db - Seed exercises
    </database>
  </commands>

  <success_criteria>
    <functionality>
      - All API endpoints return correct data
      - Authentication flow works end-to-end
      - Workout logging captures all data accurately
      - Goals track progress correctly
      - Recovery scores calculate properly
    </functionality>
    <code_quality>
      - TypeScript strict mode passes
      - All tests pass
      - No linting errors
      - Follows established patterns
    </code_quality>
    <user_experience>
      - Responsive on mobile and desktop
      - Fast load times
      - Clear feedback for all actions
      - Intuitive navigation
    </user_experience>
  </success_criteria>
</project_specification>
